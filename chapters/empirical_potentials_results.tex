In order to test the validity of using neural networks sampled
from molecular dynamics trajectories to generate new trajectories
we train neural networks on systems of copper and silicon atoms
using the Effective Medium Theory and Stillinger-Weber potentials
respectively. These potentials have efficient implementations
through ASE and their ASAP interface, which makes
it ideal for our purposes. Additionally these potentials
have an intermediate complexity, with Stillinger-Weber explicitly
including threebody interactions, which makes them ideal
for testing whether the Behler-Parrinello method can replicate this.
At temperatures which are not too large these potentials describe
atoms in a crystalline structure in equilibrium,
and we test whether the neural network can reproduce the correct potential
energy, forces, radial distribution and mean squared displacement.
In table \ref{tab:hyperparam} we have listed the parameters we have
used in the training process. While we have used a large amount
of training images for the energy training, since this is relatively
inexpensive, 20000 training images was a noticeable over approximately
5000-10000 images, and only seemed to affect the speed of convergence.
In table \ref{tab:hyperparam-test} we have listed the parameters
used for testing the neural network. For sampling data we used a larger
timestep and sampling interval
than for applying the neural network, in order to obtain
a larger diversity of configurations, though this did not seem to
matter much for the final result.

\begin{table}[H]
\label{tab:hyperparam}
\caption{Hyperparameters used in fitting.}
\begin{center}
\begin{tabular}{|c c|}
\hline
Hyperparameter & Value \\
\hline \hline
Symmetry functions & 16 radial, 24 angular \\
    Hidden layers & $(10, 10)$ \\
Activation & Hyperbolic tangent \\
    Timesteps (fs) & $8 \cdot 10^5$ \\
    Sampling intervall (fs) & 100 \\
Max epochs & 4000 \\
Optimizer & BFGS \\
Energy coefficient & 1.0 \\
Force coefficient & 0.1 \\
\hline
\end{tabular}
\end{center}
\end{table}

\begin{table}[H]
\label{tab:hyperparam-test}
\caption{Hyperparameters used in testing.}
\begin{center}
\begin{tabular}{|c c|}
\hline
Hyperparameter & Value \\
\hline \hline
Symmetry functions & 16 radial, 24 angular \\
    Hidden layers & $(10, 10)$ \\
Activation & Hyperbolic tangent \\
    Timesteps (fs) & $8 \cdot 10^5$ \\
    Sampling intervall (fs) & 100 \\
Max epochs & 4000 \\
Optimizer & BFGS \\
Energy coefficient & 1.0 \\
Force coefficient & 0.1 \\
\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Effective Medium Theory}
The Effective Medium Theory (EMT) potential gives a good description
of the late transition metals in a Face-Centered Cubic (FCC) crystal
lattice, and has a very efficient implementation in ASE,
which makes it ideal for producing large amounts of data.
We will use a rather small system of $4 \times 2^3 = 32$ atoms
for training, since this means a larger amount of labels available
for atoms when we are only using the potential energy.
We train with only the energy for $8 \cdot 10^5$ steps
with a timestep of $\Delta t = 5.0$ fs
writing to file every 100 steps and then subsequently
train using both energy and forces for $5 \cdot 10^4$ steps
for a total of 500 configurations. We train on both sets of images
for 2000 steps, where the BFGS optimizer has generally converged.
After the calculator is trained we compare the performance
of the neural network with the EMT potential on a system
of 32 atoms with a temperature of 300 Kelvin for 5000 steps.

\begin{figure}[H]
\begin{adjustbox}{max width=1.2\linewidth,center}
\centering
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{copper_energy_log.png}
      \caption{Training loss and energy RMSE.}
    \label{fig:f1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{copper_force_log.png}
      \caption{Training loss and energy and force RMSE.}
    \label{fig:f2}
  \end{subfigure}
\end{adjustbox}
\caption{My flowers.}
    \label{fig:copper_log}
\end{figure}

In figure \ref{fig:copper_log} we have plotted the loss and root mean
squared errors for the training process.
We see that the training process for the energy training
continues to decrease after about 1000 steps, though
the updates are smaller than before.
For the force training we have converged after
approximately 200-400 steps, after which the energy RMSE
stabilizes.

\begin{figure}[H]
\begin{adjustbox}{max width=1.2\linewidth,center}
\centering
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{copper_energy_error.png}
      \caption{Energy error.}
    \label{fig:f1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{copper_force_error.png}
      \caption{Force component error.}
    \label{fig:f2}
  \end{subfigure}
\end{adjustbox}
    \caption{Energy and force component errors on test trajectory.}
    \label{fig:copper_error}
\end{figure}

In figure \ref{fig:copper_error} we have plotted the energy and force
absolute errors on the test images. We obtain an energy error
of approximately 0.1 eV, with a max value of approximately 0.16 eV.
For the force errors we obtain an force RMSE of 0.05 eV/Ã…,
but some of the force errors considerably higher, which poses
a problem for the long term stability of the system.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{copper_rdf.png}
    \caption{AMP radial distribution function plotted against
        EMT RDF.}
    \label{fig:copper-rdf}
\end{figure}

In figure \ref{fig:copper-rdf} we have plotted the AMP neural network
radial distribution function compared to the EMT RDF.
We see that the AMP potential can reproduce the copper crystal
structure fairly well, though with smaller peaks.
The disparity is caused by an increase in kinetic energy over time
which makes the atoms more dispersed.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{copper_pot.png}
    \caption{AMP and EMT potential energy as a function of time.}
    \label{fig:copper-pot}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{copper_energy.png}
    \caption{AMP and EMT total energy as a function of time.}
    \label{fig:copper-energy}
\end{figure}

In figure \ref{fig:copper-pot} we have plotted the potential energy
over time compared to the EMT potential. We see that the AMP potential
can reproduce EMT energies reasonably well at the beginning, though
a seemingly linear increase in potential energy.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{copper_msd.png}
    \caption{AMP and EMT mean squared displacements as a function of time.}
    \label{fig:copper-msd}
\end{figure}

\subsection{Stillinger-Weber}
The Stillinger-Weber is a potential which describes accurately
Silicon atoms in the diamond lattice structure, and was
one of the first potentials used to describe a realstic atomic-scale
model of Silicon. It is also one of the most common examples
of a potential with a threebody interaction, and its intermediate complexity
makes it ideal for verification with for example quantum calculations
or in our case machine learning methods.
As in the previous section we integrate the system over $8 \cdot 10^5$
steps using a timestep of $\Delta t = 5.0$ fs (suitable for most metals
in a crystalline structure) for a total of 8000 images for energy learning
and 500 images used to train forces. We train for 4000 epochs, since
the loss function is then usually suitably converged.
We generate a test set with identical positions and velocities
using the Stillinger-Weber potential and assess whether the neural network
can accurately reproduce the potential energy, radial distribution function
and more.

\begin{figure}[H]
\begin{adjustbox}{max width=1.2\linewidth,center}
\centering
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{silicon_energy_log.png}
    \caption{Flower one.}
    \label{fig:f1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{silicon_force_log.png}
    \caption{Flower two.}
    \label{fig:f2}
  \end{subfigure}
\end{adjustbox}
\caption{My flowers.}
    \label{fig:default}
\end{figure}

\begin{figure}[H]
\begin{adjustbox}{max width=1.2\linewidth,center}
\centering
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{silicon_energy_error.png}
    \caption{Flower one.}
    \label{fig:f1}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.55\textwidth}
      \includegraphics[width=\textwidth]{silicon_force_error.png}
    \caption{Flower two.}
    \label{fig:f2}
  \end{subfigure}
\end{adjustbox}
\caption{My flowers.}
    \label{fig:default}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{silicon_rdf.png}
    \caption{Caption}
    \label{fig:silicon-rdf}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{silicon_pot.png}
    \caption{Caption}
    \label{fig:silicon-energy}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{silicon_energy.png}
    \caption{Caption}
    \label{fig:silicon-energy}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{silicon_msd.png}
    \caption{Caption}
    \label{fig:silicon-energy}
\end{figure}
